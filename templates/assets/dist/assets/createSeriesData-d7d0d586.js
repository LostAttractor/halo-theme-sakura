import{S as R,p as B,g as b,h as X,f as H,o as L,n as Y,d as Z,l as J,q as $}from"./graphic-36a77ffa.js";import{bM as I,bN as W,bO as ee,bP as ae,bQ as ne,bR as ie,bl as K,bS as re,bT as oe,bU as te,bV as se,bW as le,bH as _,bX as q,bC as fe,e as de,aI as ce,bY as ue,bu as ve,bB as me}from"./Axis-a1d70b1f.js";function Oe(a,e){return z(a,e).dimensions}function z(a,e){I(a)||(a=W(a)),e=e||{};var o=e.coordDimensions||[],n=e.dimensionsDefine||a.dimensionsDefine||[],r=R(),i=[],s=De(a,o,n,e.dimensionsCount),u=e.canOmitUnusedDimensions&&ee(s),c=n===a.dimensionsDefine,h=c?ae(a):ne(n),p=e.encodeDefine;!p&&e.encodeDefaulter&&(p=e.encodeDefaulter(a,s));for(var C=R(p),x=new ie(s),g=0;g<x.length;g++)x[g]=-1;function M(l){var f=x[l];if(f<0){var d=n[l],m=L(d)?d:{name:d},t=new le,S=m.name;S!=null&&h.get(S)!=null&&(t.name=t.displayName=S),m.type!=null&&(t.type=m.type),m.displayName!=null&&(t.displayName=m.displayName);var v=i.length;return x[l]=v,t.storeDimIndex=l,i.push(t),t}return i[f]}if(!u)for(var g=0;g<s;g++)M(g);C.each(function(l,f){var d=K(l).slice();if(d.length===1&&!B(d[0])&&d[0]<0){C.set(f,!1);return}var m=C.set(f,[]);b(d,function(t,S){var v=B(t)?h.get(t):t;v!=null&&v<s&&(m[S]=v,U(M(v),f,S))})});var D=0;b(o,function(l){var f,d,m,t;if(B(l))f=l,t={};else{t=l,f=t.name;var S=t.ordinalMeta;t.ordinalMeta=null,t=X({},t),t.ordinalMeta=S,d=t.dimsDef,m=t.otherDims,t.name=t.coordDim=t.coordDimIndex=t.dimsDef=t.otherDims=null}var v=C.get(f);if(v!==!1){if(v=K(v),!v.length)for(var w=0;w<(d&&d.length||1);w++){for(;D<s&&M(D).coordDim!=null;)D++;D<s&&v.push(D++)}b(v,function(Q,j){var N=M(Q);if(c&&t.type!=null&&(N.type=t.type),U(H(N,t),f,j),N.name==null&&d){var F=d[j];!L(F)&&(F={name:F}),N.name=N.displayName=F.name,N.defaultTooltip=F.defaultTooltip}m&&H(N.otherDims,m)})}});function U(l,f,d){re.get(f)!=null?l.otherDims[f]=d:(l.coordDim=f,l.coordDimIndex=d,r.set(f,!0))}var E=e.generateCoord,A=e.generateCoordCount,T=A!=null;A=E?A||1:0;var G=E||"value";function k(l){l.name==null&&(l.name=l.coordDim)}if(u)b(i,function(l){k(l)}),i.sort(function(l,f){return l.storeDimIndex-f.storeDimIndex});else for(var V=0;V<s;V++){var y=M(V),P=y.coordDim;P==null&&(y.coordDim=ye(G,r,T),y.coordDimIndex=0,(!E||A<=0)&&(y.isExtraCoord=!0),A--),k(y),y.type==null&&(oe(a,V)===te.Must||y.isExtraCoord&&(y.otherDims.itemName!=null||y.otherDims.seriesName!=null))&&(y.type="ordinal")}return ge(i),new se({source:a,dimensions:i,fullDimensionCount:s,dimensionOmitted:u})}function ge(a){for(var e=R(),o=0;o<a.length;o++){var n=a[o],r=n.name,i=e.get(r)||0;i>0&&(n.name=r+(i-1)),i++,e.set(r,i)}}function De(a,e,o,n){var r=Math.max(a.dimensionsDetectedCount||1,e.length,o.length,n||0);return b(e,function(i){var s;L(i)&&(s=i.dimsDef)&&(r=Math.max(r,s.length))}),r}function ye(a,e,o){if(o||e.hasKey(a)){for(var n=0;e.hasKey(a+n);)n++;a+=n}return e.set(a,!0),a}var Ce=function(){function a(e){this.coordSysDims=[],this.axisMap=R(),this.categoryAxisMap=R(),this.coordSysName=e}return a}();function he(a){var e=a.get("coordinateSystem"),o=new Ce(e),n=pe[e];if(n)return n(a,o,o.axisMap,o.categoryAxisMap),o}var pe={cartesian2d:function(a,e,o,n){var r=a.getReferringComponents("xAxis",_).models[0],i=a.getReferringComponents("yAxis",_).models[0];e.coordSysDims=["x","y"],o.set("x",r),o.set("y",i),O(r)&&(n.set("x",r),e.firstCategoryDimIndex=0),O(i)&&(n.set("y",i),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},singleAxis:function(a,e,o,n){var r=a.getReferringComponents("singleAxis",_).models[0];e.coordSysDims=["single"],o.set("single",r),O(r)&&(n.set("single",r),e.firstCategoryDimIndex=0)},polar:function(a,e,o,n){var r=a.getReferringComponents("polar",_).models[0],i=r.findAxisModel("radiusAxis"),s=r.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],o.set("radius",i),o.set("angle",s),O(i)&&(n.set("radius",i),e.firstCategoryDimIndex=0),O(s)&&(n.set("angle",s),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},geo:function(a,e,o,n){e.coordSysDims=["lng","lat"]},parallel:function(a,e,o,n){var r=a.ecModel,i=r.getComponent("parallel",a.get("parallelIndex")),s=e.coordSysDims=i.dimensions.slice();b(i.parallelAxisIndex,function(u,c){var h=r.getComponent("parallelAxis",u),p=s[c];o.set(p,h),O(h)&&(n.set(p,h),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=c))})}};function O(a){return a.get("type")==="category"}function Se(a,e){var o=a.get("coordinateSystem"),n=ve.get(o),r;return e&&e.coordSysDims&&(r=$(e.coordSysDims,function(i){var s={name:i},u=e.axisMap.get(i);if(u){var c=u.get("type");s.type=me(c)}return s})),r||(r=n&&(n.getDimensionsInfo?n.getDimensionsInfo():n.dimensions.slice())||["x","y"]),r}function xe(a,e,o){var n,r;return o&&b(a,function(i,s){var u=i.coordDim,c=o.categoryAxisMap.get(u);c&&(n==null&&(n=s),i.ordinalMeta=c.getOrdinalMeta(),e&&(i.createInvertedIndices=!0)),i.otherDims.itemName!=null&&(r=!0)}),!r&&n!=null&&(a[n].otherDims.itemName=0),n}function Ee(a,e,o){o=o||{};var n=e.getSourceManager(),r,i=!1;a?(i=!0,r=W(a)):(r=n.getSource(),i=r.sourceFormat===q);var s=he(e),u=Se(e,s),c=o.useEncodeDefaulter,h=Y(c)?c:c?Z(fe,u,e):null,p={coordDimensions:u,generateCoord:o.generateCoord,encodeDefine:e.getEncode(),encodeDefaulter:h,canOmitUnusedDimensions:!i},C=z(r,p),x=xe(C.dimensions,o.createInvertedIndices,s),g=i?null:n.getSharedDataStore(C),M=de(e,{schema:C,store:g}),D=new ce(C,e);D.setCalculationInfo(M);var U=x!=null&&Me(r)?function(E,A,T,G){return G===x?T:this.defaultDimValueGetter(E,A,T,G)}:null;return D.hasItemOption=!1,D.initData(i?r:g,null,U),D}function Me(a){if(a.sourceFormat===q){var e=Ae(a.data||[]);return!J(ue(e))}}function Ae(a){for(var e=0;e<a.length&&a[e]==null;)e++;return a[e]}export{Oe as a,Ee as c,z as p};
