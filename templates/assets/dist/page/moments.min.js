import{d as g}from"../main.min.js";class h{static async like(o,t,e){const n=await fetch("/apis/api.halo.run/v1alpha1/trackers/upvote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:o,plural:t,name:e})});if(n.status!==200){console.error("点赞失败，请求异常");return}return n}}var y=Object.defineProperty,S=Object.getOwnPropertyDescriptor,f=(m,o,t,e)=>{for(var n=e>1?void 0:e?S(o,t):o,r=m.length-1,s;r>=0;r--)(s=m[r])&&(n=(e?s(o,t,n):s(n))||n);return e&&n&&y(o,t,n),n};class d{registerMomentListPagination(){const o=document.getElementById("moment-list-pagination");if(!o)return;const t=o.querySelector("a");t&&t.addEventListener("click",e=>{e.preventDefault();const n=document.querySelector(".moments-container .moments-inner");if(!n)return;const r=e.target,s=r.href;r.classList.add("loading"),r.textContent="",fetch(s,{method:"GET"}).then(i=>i.text()).then(i=>{const c=new DOMParser().parseFromString(i,"text/html"),a=c.querySelector(".moments-container .moments-inner");if(a){this.registerMomentItem(a);const l=a.querySelectorAll(".moments-item");l&&l.length>0&&l.forEach(p=>{n.appendChild(p)})}const u=c.querySelector("#moment-list-pagination a");u?r.href=u.href:o.innerHTML=""}).catch(i=>{console.error(i)}).finally(()=>{r.classList.remove("loading"),r.textContent="加载更多..."})})}registerMomentItem(o){const t=o||document.querySelector(".moments-container .moments-inner");if(!t)return;const e=t.querySelectorAll(".moments-item");!e||e.length<=0||e.forEach(n=>{this.registerMomentItemLike(n),this.registerMomentItemComment(n)})}registerMomentItemLike(o){const t=JSON.parse(localStorage.getItem("momentlikedIds")||"[]"),e=o.querySelector(".moment-tools .moment-like");if(!e)return;const n=o.getAttribute("data-name")||"";if(t&&(t!=null&&t.includes(n))){e.classList.add("on");return}e.addEventListener("click",()=>{let r=Number(e.getAttribute("data-links")||"0");h.like("moment.halo.run","moments",n).then(()=>{r+=1,t.push(n),e.classList.add("on"),e.setAttribute("data-links",r.toString());const s=e.querySelector(".moment-like-text");s&&(s.textContent=r.toString()),localStorage.setItem("momentlikedIds",JSON.stringify(t))})},{once:!0})}registerMomentItemComment(o){const t=o.querySelector(".moment-tools .comment-js");t&&t.addEventListener("click",()=>{const e=o.querySelector(".comment-box");e==null||e.classList.toggle("is-show")})}}f([g(!1)],d.prototype,"registerMomentListPagination",1);f([g(!1)],d.prototype,"registerMomentItem",1);
